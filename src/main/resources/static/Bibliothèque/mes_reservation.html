<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Mes RÃ©servations</title>
    <link rel="stylesheet" href="bu.css">
</head>

<body>

<header>
    <h1 style="text-align:center;">ðŸ“š Mes RÃ©servations</h1>
</header>

<main class="page">

    <!-- ðŸ”¥ Correctif : bonne classe correspondant au CSS -->
    <section class="reservations-list" id="reservationsList"></section>

</main>

<script>
    /* ============================================================
       CHARGER LES RÃ‰SERVATIONS DU BACKEND
    ============================================================ */

    async function loadReservations() {
        try {
            const res = await fetch("http://localhost:8080/api/reservations/user/1");
            const reservations = await res.json();

            const container = document.querySelector(".reservations-list");
            container.innerHTML = "";

            if (!reservations || reservations.length === 0) {
                container.innerHTML = "<p>Aucune rÃ©servation en cours.</p>";
                return;
            }

            reservations.forEach(r => {

                const date = r.dateReservation ? r.dateReservation.substring(0,10) : "â€”";

                const card = document.createElement("article");
                card.className = "reservation-card";

                card.innerHTML = `
                    <img src="cover_${r.idLivre}.png" class="cover">

                    <div>
                        <h3>Livre #${r.idLivre}</h3>
                        <p class="author">Utilisateur : ${r.idUser}</p>
                        <div class="book-meta">RÃ©servÃ© le : ${date}</div>
                    </div>

                    <button class="btn-cancel" data-id="${r.id}">Annuler</button>
                `;

                container.appendChild(card);
            });

            // ðŸ”¥ Ajout de l'action "Annuler"
            document.querySelectorAll(".btn-cancel").forEach(btn => {
                btn.addEventListener("click", () => {
                    const id = btn.dataset.id;
                    annulerReservation(id);
                });
            });

        } catch (e) {
            console.error("Erreur de chargement :", e);
        }
    }


    /* ============================================================
       ANNULER UNE RÃ‰SERVATION
    ============================================================ */

    async function annulerReservation(idReservation) {

        if (!confirm("Voulez-vous vraiment annuler cette rÃ©servation ?")) return;

        try {
            await fetch(`http://localhost:8080/api/reservations/${idReservation}`, {
                method: "DELETE"
            });

            loadReservations(); // ðŸ”¥ recharge proprement

        } catch (e) {
            alert("Erreur lors de l'annulation");
            console.error(e);
        }
    }


    /* ============================================================
       INIT
    ============================================================ */

    document.addEventListener("DOMContentLoaded", loadReservations);

</script>

</body>
</html>
