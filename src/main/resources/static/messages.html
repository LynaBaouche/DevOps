<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Messagerie Privée – EtudLife</title>
    <link rel="stylesheet" href="messages.css">
</head>
<body>

<header class="main-header">
    <div class="header-container">
        <div class="header-left">
            <div class="logo">
                <img src="images/etudlife.png" alt="Logo EtudLife" class="logo-icon">

                <span class="logo-text"><strong>Etud</strong>Life</span>
            </div>
        </div>

        <nav class="header-nav">
            <a href="index.html">Accueil</a>
            <a href="Agenda.html" id="link-agenda">Agenda</a>

            <a href="upload.html">Cours</a>
            <a href="#">Transports</a>
            <a href="#">Bibliothèque</a>
            <a href="#">Campus</a>
            <a href="#">Restaurant</a>
            <a href="#">Annonces</a>
            <a href="messages.html" class="active">Messages</a>
            <a href="#">Rechercher</a>
        </nav>


        <!-- Icône compte -->
        <div class="account-menu">
            <img src="images/compte.png" class="icon-img" id="account-icon">

            <!-- MENU DÉROULANT -->
            <div class="dropdown-menu" id="dropdown-menu">
                <p class="menu-title">Invité</p>
                <p class="menu-subtitle">Non connecté</p>

                <a id="btn-profil" class="menu-item connected-only" style="display:none;">Profil</a>

                <a href="login.html" class="menu-item disconnected-only">Se connecter</a>
                <a href="inscription.html" class="menu-item disconnected-only">Créer un compte</a>
                <a href="#" class="menu-item">Aide</a>

                <a id="logout-btn" class="menu-item connected-only" style="display:none;">Se déconnecter</a>
            </div>

        </div>

    </div>
</header>

<main class="messagerie">
    <section class="conversations">
        <div class="search">
            <input type="text" id="searchInput" placeholder="Rechercher une conversation...">
        </div>

        <ul id="conversationList">
            <!-- Liste des conversations -->
        </ul>
    </section>

    <section class="chat">
        <div class="chat-header" id="chatHeader">
            <span class="contact-nom">Sélectionnez une conversation</span>
            <small id="contactStatut"></small>
        </div>

        <div class="messages" id="messagesContainer">
            <p class="placeholder">Aucune conversation ouverte.</p>
        </div>

        <form id="messageForm" class="chat-input">
            <textarea id="messageInput" placeholder="Tapez votre message..." maxlength="500"></textarea>
            <button type="submit">➤</button>
        </form>
    </section>
</main>

<script src="messages.js"></script>
<script>
    const icon = document.getElementById("account-icon");
    const menu = document.getElementById("dropdown-menu");

    icon.addEventListener("click", () => {
        menu.style.display = menu.style.display === "block" ? "none" : "block";
    });

    // Fermer quand on clique ailleurs
    document.addEventListener("click", (e) => {
        if (!icon.contains(e.target) && !menu.contains(e.target)) {
            menu.style.display = "none";
        }
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const menuTitle = document.querySelector(".menu-title");
        const menuSubtitle = document.querySelector(".menu-subtitle");

        const user = JSON.parse(localStorage.getItem("utilisateur"));

        if (user) {
            // Mise à jour nom + email dans le menu
            menuTitle.textContent = user.prenom + " " + user.nom;
            menuSubtitle.textContent = user.email;
        }
    });
</script>
</body>
</html>
