<!DOCTYPE html>
<html lang="fr">

<head>


    <script>
        const user = JSON.parse(localStorage.getItem("utilisateur"));
        if (!user) {
            alert("‚ö†Ô∏è Vous devez vous connecter pour acc√©der aux annonces.");
            window.location.href = "/login.html";
        }
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Petites Annonces | EtudLife</title>

    <link rel="stylesheet" href="/Annonce/annonces.css">
    <script defer src="/Annonce/annonces.js"></script>

</head>


<body class="page-annonces">

<header class="main-header">
    <div class="header-container">

        <!-- Logo -->
        <div class="header-left">
            <div class="logo">
                <img src="/images/etudlife.png" alt="Logo EtudLife" class="logo-icon">
                <span class="logo-text"><strong>Etud</strong>Life</span>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="header-nav">
            <a href="/index.html">Accueil</a>
            <a href="/Agenda.html">Agenda</a>
            <a href="/upload.html">Cours</a>
            <a href="#">Transports</a>
            <a href="/Biblioth√®que/bibliotheque.html">Biblioth√®que</a>
            <a href="#">Campus</a>
            <a href="/Recette/cuisine.html">Cuisine</a>
            <a href="/Annonce/annonces.html" class="active">Annonces</a>
            <a href="/messages.html">Messages</a>
            <a href="/proches.html">Ajouter un proche</a>
        </nav>

        <!-- Compte utilisateur -->
        <div class="account-menu">
            <img src="/images/compte.png" class="icon-img" id="account-icon">

            <div class="dropdown-menu" id="dropdown-menu">
                <p class="menu-title">Invit√©</p>
                <p class="menu-subtitle">Non connect√©</p>

                <a href="/index.html?profil=true"
                   class="menu-item connected-only"
                   id="btn-profil">
                    Profil
                </a>

                <a href="/login.html" class="menu-item disconnected-only">Se connecter</a>
                <a href="/inscription.html" class="menu-item disconnected-only">Cr√©er un compte</a>
                <a href="#" class="menu-item">Aide</a>
                <a id="logout-btn" class="menu-item connected-only" style="display:none;">Se d√©connecter</a>
            </div>
        </div>

    </div>
</header>


<!-- ============================================================
        üìÑ CONTENU ‚Äî WRAPPER QUI FIXE LE PROBL√àME D‚ÄôALIGNEMENT
=============================================================== -->
<div class="annonces-content">

    <h1 class="title">Petites Annonces</h1>

    <!-- Boutons favoris + mes annonces -->
    <div class="annonce-top-actions">
        <button id="btn-favoris" class="action-btn" onclick="window.location.href='/Annonce/favoris.html'">
            ü§ç Mes favoris <span id="fav-count">0</span>
        </button>

        <button id="btn-mes-annonces" class="action-btn primary" onclick="window.location.href='/Annonce/mes_annonces.html'">
            üìò Mes annonces
        </button>
    </div>

    <p class="subtitle">
        Logements, cours particuliers, emplois et services pour √©tudiants
    </p>

    <!-- Barre de recherche -->
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Rechercher une annonce...">
    </div>

    <!-- Filtres -->
    <div class="filters">
        <button data-cat="toutes" class="filter active">Toutes</button>
        <button data-cat="logement" class="filter">Logement</button>
        <button data-cat="cours" class="filter">Cours particuliers</button>
        <button data-cat="emploi" class="filter">Emplois</button>
        <button data-cat="service" class="filter">Services</button>
        <button data-cat="objet" class="filter">Objets</button>
    </div>

    <!-- Statistiques -->
    <div id="stats" class="stats-boxes"></div>

    <!-- Liste des annonces -->
    <div id="annonces-list" class="annonces-grid"></div>

</div> <!-- FIN annonces-content -->


<div id="detailsModal" class="modal hidden">

    <div class="modal-overlay"></div>

    <div class="modal-box">

        <!-- IMAGE TOP -->
        <img id="modal-img" class="modal-img" alt="Image annonce">

        <div class="modal-body">

            <!-- HEADER TITRE + PRIX + DATE -->
            <div class="modal-header">
                <h2 id="modal-title" class="modal-title"></h2>

                <div class="modal-price-date">
                    <span id="modal-prix" class="modal-price"></span>
                    <span id="modal-date" class="modal-date"></span>
                </div>

                <span id="closeModal" class="modal-close">&times;</span>
            </div>

            <!-- BADGE CAT -->
            <span id="modal-cat" class="modal-badge"></span>

            <!-- INFORMATIONS -->
            <div class="modal-info">
                <p>üìç <strong>Localisation :</strong> <span id="modal-ville"></span></p>
                <p>üë§ <strong>Publi√© par :</strong> <span id="modal-auteur"></span></p>
            </div>

            <!-- DESCRIPTION -->
            <h3>Description</h3>
            <p id="modal-desc"></p>

            <!-- LIEN EXTERNE -->
            <div id="modal-link" style="margin-top:15px;"></div>



            <!-- ACTIONS -->
            <div class="modal-actions">
                <button id="modal-fav-btn" class="fav-btn">ü§ç Ajouter aux favoris</button>

            </div>

        </div>

    </div>
</div>


<script>
    document.addEventListener("DOMContentLoaded", () => {
        const accountIcon = document.getElementById("account-icon");
        const dropdown = document.getElementById("dropdown-menu");

        if (!accountIcon || !dropdown) return;

        accountIcon.addEventListener("click", (e) => {
            e.stopPropagation();
            dropdown.classList.toggle("show");
        });

        // Fermer le menu si on clique ailleurs
        document.addEventListener("click", () => {
            dropdown.classList.remove("show");
        });

        dropdown.addEventListener("click", (e) => {
            e.stopPropagation();
        });

        // üîê Gestion utilisateur connect√©
        const user = JSON.parse(localStorage.getItem("utilisateur"));

        if (user) {
            dropdown.querySelector(".menu-title").textContent =
                `${user.prenom || ""} ${user.nom || ""}`.trim() || "Utilisateur";
            dropdown.querySelector(".menu-subtitle").textContent = user.email || "";
            document.querySelectorAll(".connected-only").forEach(el => el.style.display = "block");
            document.querySelectorAll(".disconnected-only").forEach(el => el.style.display = "none");
        }

        // üö™ D√©connexion
        document.getElementById("logout-btn")?.addEventListener("click", () => {
            localStorage.removeItem("utilisateur");
            window.location.href = "/login.html";
        });
    });
</script>



</body>
</html>
