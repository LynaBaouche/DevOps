<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Mes Favoris | EtudLife</title>

    <!-- CSS partag√© -->
    <link rel="stylesheet" href="/Annonce/annonces.css">

    <!-- JS des favoris -->
    <script defer src="/Annonce/annonces.js"></script>
</head>

<body>

<section class="favoris-container">

    <!-- üîô Retour -->
    <button class="btn-blue" onclick="window.location.href='/Annonce/annonces.html'" style="margin-bottom:20px;">
        ‚Üê Retour aux annonces
    </button>

    <h1>Mes Favoris</h1>
    <p class="subtitle">Retrouvez toutes les annonces que vous avez aim√©es</p>

    <div class="card-stats">

        <div class="stat-left">
            <span class="stat-icon">‚ù§Ô∏è</span>

            <div class="stat-info">
                <h2 id="fav-count-display">3</h2>
                <p>Annonces favorites</p>
            </div>
        </div>

        <button class="btn-blue btn-small" onclick="window.location.href='annonces.html'">
            + D√©couvrir plus d‚Äôannonces
        </button>

    </div>


    <!-- ü©∂ Zone vide -->
    <div id="empty-favoris" class="empty-favoris hidden">
        <div class="empty-icon">ü§ç</div>
        <h3>Aucun favori pour le moment</h3>
        <p>Commencez √† ajouter des annonces √† vos favoris pour les retrouver ici</p>

        <button class="btn-blue" onclick="window.location.href='/Annonce/annonces.html'">
            üîç Parcourir les annonces
        </button>
    </div>

    <!-- üü• Grille de favoris -->
    <div id="favoris-list" class="annonces-grid"></div>

</section>

<script>
    /* ============================
       üî• R√âCUP√âRATION DES FAVORIS
    ============================ */
    const favContainer = document.getElementById("favoris-list");
    const emptySection = document.getElementById("empty-favoris");

    // ‚ö†Ô∏è Le bon compteur dans favoris.html :
    const favCountDisplay = document.getElementById("fav-count-display");

    const user = JSON.parse(localStorage.getItem("utilisateur"));
    const key = `favoris_user_${user.id}`;
    let favoris = JSON.parse(localStorage.getItem(key)) || [];

    // Mise √† jour du compteur
    favCountDisplay.textContent = favoris.length;

    /* Si aucun favori ‚Üí afficher message vide */
    if (favoris.length === 0) {
        emptySection.classList.remove("hidden");
    } else {
        displayFavoris();
    }

    /* ============================
       üü• AFFICHER LES FAVORIS
    ============================ */
    function displayFavoris() {

        favContainer.innerHTML = favoris
            .map(a => `
            <div class="card-pro">

                <div class="card-img-wrapper">
                    <img src="/images/${a.image}" class="card-img">
                    <span class="cat-badge">${a.categorie}</span>
                </div>

                <div class="card-body">
                    <h3>${a.titre}</h3>
                    <p>${a.description.substring(0,100)}...</p>

                    <div class="price-date">
                        <span class="price">${a.prix}</span>
                        <span class="date">${a.datePublication}</span>
                    </div>

                    <div class="icons">
                        <p>üìç ${a.ville}</p>
                        <p>üë§ ${a.auteur}</p>
                    </div>

                    <div class="card-actions">
                        <button class="btn-details" onclick="openDetails(${a.id})">
                            Voir d√©tails
                        </button>

                        <!-- Bouton favoris rouge -->
                        <button class="btn-fav active" onclick='removeFavori(${a.id})'>
                            ‚ù§Ô∏è
                        </button>
                    </div>
                </div>
            </div>
        `)
            .join("");
    }

    /* ============================
       ‚ùå SUPPRESSION D‚ÄôUN FAVORI
    ============================ */
    function removeFavori(id) {
        const key = `favoris_user_${user.id}`;
        favoris = favoris.filter(f => f.id !== id);
        localStorage.setItem(key, JSON.stringify(favoris));

        favCountDisplay.textContent = favoris.length;

        if (favoris.length === 0) {
            favContainer.innerHTML = "";
            emptySection.classList.remove("hidden");
        } else {
            displayFavoris();
        }
    }

</script>

</body>
</html>
